<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moment 2: Your Mission - Vibe</title>
    <link rel="stylesheet" href="css/common.css">
</head>
<body>
    <div class="container">
        <!-- Progress Bar -->
        <div id="progress-container"></div>

        <!-- Header -->
        <div id="header-container"></div>

        <!-- Formula Card -->
        <div class="card">
            <h3>Create Your Mission Statement</h3>
            <p>A mission statement is a clear sentence that explains what your business does. Use this formula:</p>

            <div class="formula-box">
                <strong>I help [WHO] do [WHAT] by [HOW] because [WHY IT MATTERS]</strong>
            </div>
        </div>

        <!-- Your Idea Reminder -->
        <div class="card" style="background: var(--background);">
            <p style="margin-bottom: 8px; font-size: 14px; color: var(--text-muted);">Your idea from Moment 1:</p>
            <p id="idea-reminder" style="margin-bottom: 0; font-style: italic;"></p>
        </div>

        <!-- Mission Input -->
        <div class="card">
            <div class="form-group">
                <label for="mission">Your mission statement:</label>
                <textarea
                    id="mission"
                    data-field="mission"
                    placeholder="I help [who] do [what] by [how] because [why it matters]..."
                ></textarea>
                <p class="hint">Keep it to 1-2 sentences. It's okay if it's not perfect - you can always refine it later.</p>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-header-icon">AI</div>
                <div class="chat-header-title">AI Coach</div>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="chat-message assistant">
                    <div class="chat-avatar">AI</div>
                    <div class="chat-bubble">
                        <p style="margin: 0;">Now let's get specific. A mission statement forces you to answer the hard questions: Who exactly are you helping? What do they actually get? Why should they choose you?<br><br>Use the formula above. If any part feels hard to write — that's a sign you need to think it through more. That's the point.</p>
                    </div>
                </div>
            </div>

            <!-- Quick Replies -->
            <div class="quick-replies" id="quick-replies" style="padding: 0 16px;">
                <button class="quick-reply-btn" onclick="askQuestion('My WHO is too vague')">My WHO is vague</button>
                <button class="quick-reply-btn" onclick="askQuestion('Review my mission')">Review my mission</button>
                <button class="quick-reply-btn" onclick="askQuestion('Show me how others do it')">How others do it</button>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <input
                    type="text"
                    class="chat-input"
                    id="chat-input"
                    placeholder="Ask me anything..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="chat-send-btn" onclick="sendMessage()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Example -->
        <div class="example-box">
            <div class="example-header">Maria's Mission Statement</div>
            <div class="example-content">
                "I help <strong>busy working parents</strong> eat healthier <strong>by preparing affordable homemade meals they can pick up weekly</strong> — because <strong>families deserve good food without the stress of cooking every night</strong>."
            </div>
        </div>

        <!-- Navigation -->
        <div class="card">
            <div id="nav-container"></div>
        </div>
    </div>

    <script src="js/session.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/demo.js"></script>
    <script>
        const MOMENT_ID = 2;

        document.addEventListener('DOMContentLoaded', () => {
            Navigation.init(MOMENT_ID);
            Navigation.renderNavButtons('nav-container', MOMENT_ID, {
                nextLabel: 'Save & Continue to Moment 3',
                onNext: 'saveAndContinue()'
            });

            // Initialize demo mode if active
            Demo.init(MOMENT_ID);

            // Show idea from moment 1
            const idea = Session.getField('idea');
            document.getElementById('idea-reminder').textContent = idea || 'No idea saved from Moment 1';

            // Load saved mission
            const savedMission = Session.getField('mission');
            if (savedMission) {
                document.getElementById('mission').value = savedMission;
            }

            // Load chat history
            loadChatHistory();

            // Auto-save
            document.getElementById('mission').addEventListener('input', (e) => {
                Session.saveField('mission', e.target.value);
            });
        });

        function loadChatHistory() {
            const history = Session.getChatHistory(MOMENT_ID);
            history.forEach(msg => {
                addMessageToChat(msg.role, msg.content, false);
            });
        }

        function addMessageToChat(role, content, save = true) {
            const container = document.getElementById('chat-messages');
            const isUser = role === 'user';

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            messageDiv.innerHTML = `
                <div class="chat-avatar">${isUser ? 'You' : 'AI'}</div>
                <div class="chat-bubble">
                    <p style="margin: 0;">${content}</p>
                </div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;

            if (save) {
                Session.saveChatMessage(MOMENT_ID, role, content);
            }
        }

        function showTyping() {
            const container = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message assistant';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="chat-avatar">AI</div>
                <div class="chat-bubble">
                    <div class="typing-indicator">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            addMessageToChat('user', message);
            input.value = '';
            generateResponse(message);
        }

        function askQuestion(question) {
            addMessageToChat('user', question);
            generateResponse(question);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function generateResponse(userMessage) {
            showTyping();

            const idea = Session.getField('idea');
            const mission = document.getElementById('mission').value.trim();
            const messageLower = userMessage.toLowerCase();

            setTimeout(() => {
                hideTyping();

                let response = '';

                // Check for demo mode - use scripted responses
                if (Demo.isActive()) {
                    const demoResponse = Demo.getResponse(MOMENT_ID, userMessage);
                    if (demoResponse) {
                        addMessageToChat('assistant', demoResponse);
                        return;
                    }
                }

                if (messageLower.includes('who') || messageLower.includes('vague')) {
                    response = "Let me push you on the <strong>WHO</strong>.<br><br>" +
                        "\"Busy parents\" is still too broad. There are millions of busy parents. Which ones?<br><br>" +
                        "<strong>Try this test:</strong> Can you picture one specific person? What's their name? Where do they live? What's their day like?<br><br>" +
                        "A meal prep entrepreneur I know narrowed it to: \"Working moms in my zip code who have kids under 10 and get home after 6pm.\" She could actually FIND these people.<br><br>" +
                        "Who's YOUR specific person?";
                } else if (messageLower.includes('what')) {
                    response = "Here's the mistake most people make with <strong>WHAT</strong>: they describe what they DO instead of what the customer GETS.<br><br>" +
                        "\"I cook meals\" = about you<br>" +
                        "\"Families eat healthier without the stress\" = about them<br><br>" +
                        "<strong>The test:</strong> Would your customer use these exact words to describe what they want? Or are you using business-speak?<br><br>" +
                        "A house cleaner told me her customers don't say \"I want cleaning services.\" They say \"I want to come home to a house that doesn't stress me out.\"<br><br>" +
                        "What would YOUR customer actually say they want?";
                } else if (messageLower.includes('clear') || messageLower.includes('review')) {
                    if (mission) {
                        // Analyze the mission
                        const hasWho = mission.toLowerCase().includes('help') ||
                                       mission.match(/for\s+\w+/i) ||
                                       mission.match(/\b(parents|families|people|customers|clients|moms|dads|seniors|professionals)\b/i);
                        const hasWhat = mission.match(/\b(by|through|via)\b/i) ||
                                        mission.match(/\b(provide|offer|deliver|give|make|save|get)\b/i);
                        const isVague = mission.match(/\b(everyone|people|anyone|help people)\b/i);

                        response = `Let me be honest about: "${mission.substring(0, 100)}${mission.length > 100 ? '...' : ''}"<br><br>`;

                        if (isVague) {
                            response += "<strong>Red flag:</strong> \"People\" or \"everyone\" is too vague. No successful business serves everyone.<br><br>" +
                                "Who's the ONE type of person who would be most excited about this? Start there.<br><br>" +
                                "<strong>Your next step:</strong> Rewrite it with a specific person in mind — someone you could actually go find this week.";
                        } else if (hasWho && hasWhat) {
                            response += "This is getting clearer. I can see who and what.<br><br>" +
                                "<strong>The real test:</strong> Read this out loud to someone who doesn't know your idea. Do they get it in 10 seconds?<br><br>" +
                                "If they say \"So you mean...\" and get it right, you're there. If they look confused, simplify further.<br><br>" +
                                "Try it with someone today. What do they say?";
                        } else if (!hasWho) {
                            response += "I can't tell WHO you're helping. \"People\" isn't specific enough.<br><br>" +
                                "<strong>Challenge:</strong> Finish this sentence: \"The person who needs this most is someone who ______.\"<br><br>" +
                                "What's the situation that makes someone NEED what you offer?";
                        } else {
                            response += "Good start on the WHO. Now I need to understand: what do they GET from you?<br><br>" +
                                "Not what you do — what changes for THEM? What problem disappears?";
                        }
                    } else {
                        response = "Write your mission statement above first, and I'll give you honest feedback!";
                    }
                } else if (messageLower.includes('others') || messageLower.includes('examples')) {
                    response = "Here's how other entrepreneurs have written clear missions:<br><br>" +
                        "<strong>Meal prep:</strong> \"I help working moms in [neighborhood] feed their families healthy dinners by delivering 5 ready-to-heat meals every Sunday.\"<br><br>" +
                        "<strong>House cleaning:</strong> \"I help busy professionals come home to a calm, clean space by doing deep cleans every two weeks — so they can actually relax on weekends.\"<br><br>" +
                        "<strong>Tutoring:</strong> \"I help middle schoolers who are struggling in math build confidence by meeting them where they are — no judgment, just progress.\"<br><br>" +
                        "Notice: each one has a <strong>specific WHO</strong>, a <strong>clear WHAT</strong>, and a <strong>reason WHY it matters</strong>.<br><br>" +
                        "What would yours sound like in this format?";
                } else if (messageLower.includes('how') || messageLower.includes('by')) {
                    response = "The <strong>HOW</strong> is what makes you different from everyone else who could solve this problem.<br><br>" +
                        "Be specific:<br>" +
                        "• Not \"I provide meals\" → \"I deliver 5 ready-to-heat dinners every Sunday\"<br>" +
                        "• Not \"I clean houses\" → \"I do a deep clean every two weeks so you never have to think about it\"<br><br>" +
                        "The HOW should answer: \"Why would someone choose YOU instead of the other options?\"<br><br>" +
                        "What's your specific approach that makes you the obvious choice?";
                } else if (messageLower.includes('why') || messageLower.includes('matter')) {
                    response = "The <strong>WHY</strong> is where most people go shallow. Let me push you deeper.<br><br>" +
                        "\"Because they don't have time\" — okay, but why does THAT matter?<br>" +
                        "\"Because they're stressed\" — why does that matter?<br>" +
                        "\"Because they feel like they're failing their family\" — NOW we're getting somewhere.<br><br>" +
                        "<strong>Ask yourself:</strong> What are they sacrificing right now because this problem exists? What guilt, stress, or frustration goes away when you solve it?<br><br>" +
                        "That's your real WHY. What is it?";
                } else {
                    // Check if they have something written
                    if (mission) {
                        response = `I see you're working on: "${mission.substring(0, 60)}..."<br><br>` +
                            "Let me ask you the hard question: <strong>If you showed this to a stranger, would they immediately understand what you do and who it's for?</strong><br><br>" +
                            "If there's any hesitation, something needs to be clearer. Which part feels weakest to you right now — the WHO, the WHAT, or the WHY?";
                    } else {
                        response = "Start writing your mission above using the formula. It doesn't have to be perfect — that's what I'm here for.<br><br>" +
                            "<strong>Just fill in the blanks:</strong><br>" +
                            "\"I help [WHO] do [WHAT] by [HOW] because [WHY].\"<br><br>" +
                            "Write something, and I'll help you make it stronger.";
                    }
                }

                addMessageToChat('assistant', response);
            }, 1000 + Math.random() * 500);
        }

        function saveAndContinue() {
            const mission = document.getElementById('mission').value.trim();

            if (!mission) {
                alert('Please write your mission statement before continuing.');
                document.getElementById('mission').focus();
                return;
            }

            Session.saveField('mission', mission);
            Session.completeMoment(MOMENT_ID);
            window.location.href = 'moment-3.html';
        }
    </script>
</body>
</html>
